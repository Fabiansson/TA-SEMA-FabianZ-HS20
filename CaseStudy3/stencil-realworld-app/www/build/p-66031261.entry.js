import{r as t,h as i}from"./p-169f3d6f.js";import"./p-3daa696c.js";import{f as s,a}from"./p-4a359652.js";const e=class{constructor(i){t(this,i),this.favoriteArticle=async t=>{const i=t.currentTarget;if(!i)return;const a=i.getAttribute("data-article-slug"),e="1"===i.getAttribute("data-article-favorited"),l=parseInt(i.getAttribute("data-article-index")),r=this.user&&this.user.token,{articles:n}=this;if(!a||!r||"number"!=typeof l)return;const o=Object.assign(Object.assign({},n[l]),{favorited:!e,favoritesCount:n[l].favoritesCount+(e?-1:1)}),c=[...n];c[l]=o,this.articles=c;const h=await s(a,r,e);h.success||(this.articles=n,console.error(h.errors))}}componentWillLoad(){this.articles=this.listedArticles}render(){return this.errors||!Array.isArray(this.articles)?[i("p",null,"There was an error fetching recent articles, details below"),i("error-display",{errors:this.errors})]:0===this.articles.length?i("p",null,"No results found"):this.articles.map(((t,s)=>i("div",{class:"article-preview"},i("div",{class:"article-meta"},i("stencil-route-link",{url:"/profile/"+t.author.username},i("img",{src:t.author.image,alt:"author image"})),i("div",{class:"info"},i("stencil-route-link",{url:"/profile/"+t.author.username,anchorClass:"author"},t.author.username),i("span",{class:"date"},new Date(t.updatedAt).toLocaleDateString("en",{month:"long",day:"2-digit",year:"numeric"}))),i("button",{class:"btn btn-sm pull-xs-right "+(t.favorited?"btn-primary":"btn-outline-primary"),"data-article-slug":t.slug,"data-article-favorited":t.favorited?"1":"0","data-article-index":s,disabled:!this.user,onClick:this.favoriteArticle},i("ion-icon",{name:"heart"})," ",t.favoritesCount)),i("stencil-route-link",{url:"/article/"+t.slug,anchorClass:"preview-link"},i("h1",null,t.title),i("p",null,t.description),i("span",null,"Read more..."),t.tagList&&i("ul",{class:"tag-list"},t.tagList.map((t=>i("li",{class:"tag-default tag-pill tag-outline"},t))))))))}},l={global:"Global Feed",feed:"Your Feed",authored:"My Articles",favorited:"Favorited Articles"},r=class{constructor(i){t(this,i),this.possibleTabs=["global"],this.currentPage=0,this.articles=[],this.articlesCount=0,this.isLoading=!0,this.listArticles=async()=>{const{user:t}=this;this.isLoading=!0;const i=`limit=10&${this.currentPage>0?`offset=${10*this.currentPage}&`:""}${this.activeTag&&"tag"===this.activeTab?`tag=${this.activeTag}&`:""}${"authored"===this.activeTab&&this.profile?`author=${this.profile.username}&`:""}${"favorited"===this.activeTab&&this.profile?`favorited=${this.profile.username}&`:""}`,s=await a({token:t&&t.token,isFeed:"feed"===this.activeTab,params:i}),{articles:e,articlesCount:l,errors:r,success:n}=s;n?(this.articles=e,this.articlesCount=l):this.errors=r,this.isLoading=!1},this.toggleTab=t=>{const i=t.target.getAttribute("data-tab-id");i&&(this.activeTab=i)},this.goToPage=t=>{const i=t.target.getAttribute("data-page-num");i&&(this.currentPage=parseInt(i),this.fetchArticles())}}fetchArticles(){"tag"!==this.activeTab&&this.clearTag&&this.clearTag(),this.listArticles()}goToTagTab(t){t&&"tag"!==this.activeTab?this.activeTab="tag":t&&this.listArticles()}componentWillLoad(){this.activeTab=this.possibleTabs[0]}componentDidLoad(){this.listArticles()}render(){const{activeTab:t,activeTag:s}=this,a=this.isProfile?"articles-toggle":"feed-toggle",e=this.articlesCount||0,r=Array(Math.ceil(this.articlesCount/10)).fill(1);return[i("div",{class:a},i("ul",{class:"nav nav-pills outline-active"},this.possibleTabs.map((s=>i("li",{class:"nav-item"},i("button",{onClick:this.toggleTab,"data-tab-id":s,class:"nav-link "+(t===s?"active disabled":""),type:"button","aria-label":`Button to toggle your ${s} feed`,disabled:t===s},l[s])))),s&&i("li",{class:"nav-item"},i("span",{class:"nav-link "+("tag"===t?"active disabled":"")},i("ion-icon",{name:"ion-pound"})," ",s)))),this.isLoading?i("loading-spinner",null):[i("article-list",{listedArticles:this.articles,errors:this.errors,user:this.user}),e>10&&i("ul",{class:"pagination"},r.map(((t,s)=>i("li",{class:"page-item "+(s===this.currentPage&&t?"active":"")},i("button",{class:"page-link",onClick:this.goToPage,"data-page-num":s},s+1)))))]]}static get watchers(){return{activeTab:["fetchArticles"],activeTag:["goToTagTab"]}}};export{e as article_list,r as tabbed_feed}